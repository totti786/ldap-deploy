global
    log stdout format raw local0
    maxconn 4096
    daemon

defaults
    log     global
    mode    tcp
    option  tcplog
    option  dontlognull
    timeout connect 10s
    timeout client  30s
    timeout server  30s
    retries 3

frontend ldap_front
    bind *:389
    mode tcp
    option tcplog
    default_backend ldap_back

frontend ldaps_front
    bind *:636
    mode tcp
    option tcplog
    default_backend ldaps_back

backend ldap_back
    mode tcp
    balance roundrobin
    option httpchk
    option tcp-check
    tcp-check connect port 389
    server ldap1 openldap-primary:389 check inter 5s fall 3 rise 2
    server ldap2 openldap-secondary:389 check inter 5s fall 3 rise 2 backup
    server ldap3 openldap-tertiary:389 check inter 5s fall 3 rise 2 backup

backend ldaps_back
    mode tcp
    balance roundrobin
    option tcp-check
    tcp-check connect port 636 ssl
    server ldap1 openldap-primary:636 check inter 5s fall 3 rise 2
    server ldap2 openldap-secondary:636 check inter 5s fall 3 rise 2 backup
    server ldap3 openldap-tertiary:636 check inter 5s fall 3 rise 2 backup

frontend stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if TRUE
